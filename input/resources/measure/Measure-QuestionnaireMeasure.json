{
  "resourceType": "Measure",
  "id": "QuestionnaireMeasure",
  "meta": {
    "profile": [ "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/computable-measure-cqfm" ]
  },
  "contained": [ {
    "resourceType": "Library",
    "id": "effective-data-requirements",
    "extension": [ {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode",
      "valueCoding": {
        "system": "http://loinc.org",
        "code": "LA6568-5"
      }
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode",
      "valueCoding": {
        "system": "http://loinc.org",
        "code": "LA6569-3"
      }
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode",
      "valueCoding": {
        "system": "http://loinc.org",
        "code": "LA6570-1"
      }
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode",
      "valueCoding": {
        "system": "http://loinc.org",
        "code": "LA6571-9"
      }
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition",
      "extension": [ {
        "url": "libraryName",
        "valueString": "PHQ9Logic"
      }, {
        "url": "name",
        "valueString": "QuestionnaireResponse"
      }, {
        "url": "statement",
        "valueString": "// Use the QuestionnaireResponse provided as a parameter if available\n// Otherwise look it up from the record\ndefine \"QuestionnaireResponse\":\n  if response is not null then\n    response\n  else\n    Last(\n      [QuestionnaireResponse] QR\n        where QR.questionnaire = 'http://somewhere.org/fhir/uv/mycontentig/Questionnaire/phq-9-questionnaire'\n        sort by (authored as FHIR.dateTime) desc\n    )"
      }, {
        "url": "displaySequence",
        "valueInteger": 0
      } ]
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition",
      "extension": [ {
        "url": "libraryName",
        "valueString": "PHQ9Logic"
      }, {
        "url": "name",
        "valueString": "Responses"
      }, {
        "url": "statement",
        "valueString": "// NOTE: This ties this logic directly to this particular rendering of the Questionnaire.\n// Ideally the items would be filtered based on Code of the Item, rather than the LinkId,\n// but that would require pulling in the Questionnaire because the QuestionnaireResponse\n// only has the LinkId.\ndefine \"Responses\":\n  \"QuestionnaireResponse\" QR\n    return QR.item I where I.linkId in {\n      'LittleInterest',\n      'FeelingDown',\n      'TroubleSleeping',\n      'FeelingTired',\n      'BadApetite',\n      'FeelingBadAboutSelf',\n      'TroubleConcetrating',\n      'MovingSpeaking'\n    }"
      }, {
        "url": "displaySequence",
        "valueInteger": 1
      } ]
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition",
      "extension": [ {
        "url": "libraryName",
        "valueString": "PHQ9Logic"
      }, {
        "url": "name",
        "valueString": "CalculateTotalScore"
      }, {
        "url": "statement",
        "valueString": "define \"CalculateTotalScore\":\n  Sum(\"Responses\" R return all AnswerCardinality(First(R.answer.value)))"
      }, {
        "url": "displaySequence",
        "valueInteger": 2
      } ]
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition",
      "extension": [ {
        "url": "libraryName",
        "valueString": "QuestionnaireMeasure"
      }, {
        "url": "name",
        "valueString": "Initial Population"
      }, {
        "url": "statement",
        "valueString": "define \"Initial Population\":\n  AgeInYearsAt(start of \"Measurement Period\") >= 18"
      }, {
        "url": "displaySequence",
        "valueInteger": 3
      } ]
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition",
      "extension": [ {
        "url": "libraryName",
        "valueString": "QuestionnaireMeasure"
      }, {
        "url": "name",
        "valueString": "Measure Population"
      }, {
        "url": "statement",
        "valueString": "// Likely some condition or other relevant characteristic such as a depression diagnosis\ndefine \"Measure Population\":\n  true"
      }, {
        "url": "displaySequence",
        "valueInteger": 4
      } ]
    } ],
    "status": "active",
    "type": {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/library-type",
        "code": "module-definition"
      } ]
    },
    "relatedArtifact": [ {
      "type": "depends-on",
      "display": "Library PHQ9Logic",
      "resource": "http://somewhere.org/fhir/uv/mycontentig/Library/PHQ9Logic"
    }, {
      "type": "depends-on",
      "display": "Library FHIRHelpers",
      "resource": "http://somewhere.org/fhir/uv/mycontentig/Library/FHIRHelpers|4.0.1"
    }, {
      "type": "depends-on",
      "display": "Code system LOINC",
      "resource": "http://loinc.org"
    } ],
    "parameter": [ {
      "name": "Measurement Period",
      "use": "in",
      "min": 0,
      "max": "1",
      "type": "Period"
    }, {
      "name": "Initial Population",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    }, {
      "name": "Measure Population",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    } ],
    "dataRequirement": [ {
      "type": "Patient",
      "profile": [ "http://hl7.org/fhir/StructureDefinition/Patient" ]
    } ]
  } ],
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  }, {
    "id": "effective-data-requirements",
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-effectiveDataRequirements",
    "valueReference": {
      "reference": "#effective-data-requirements"
    }
  } ],
  "url": "http://somewhere.org/fhir/uv/mycontentig/Measure/QuestionnaireMeasureExample",
  "name": "QuestionnaireMeasure",
  "title": "Questionnaire Measure Example",
  "status": "draft",
  "experimental": true,
  "date": "2023-07-30T04:59:04-07:00",
  "description": "Example measure illustrating a continuous variable measure calculating scores from multiple questionnaires",
  "library": [ "http://somewhere.org/fhir/uv/mycontentig/Library/QuestionnaireMeasureExample" ],
  "scoring": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/measure-scoring",
      "code": "cohort",
      "display": "Cohort"
    } ]
  },
  "type": [ {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/measure-type",
      "code": "process"
    } ]
  } ],
  "improvementNotation": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/measure-improvement-notation",
      "code": "increase"
    } ]
  },
  "group": [ {
    "id": "group-6385011c4ba3d47c885c02aa",
    "extension": [ {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-scoring",
      "valueCodeableConcept": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/measure-scoring",
          "code": "cohort",
          "display": "Cohort"
        } ]
      }
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-populationBasis",
      "valueCode": "Encounter"
    }, {
      "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-type",
      "valueCodeableConcept": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/measure-type",
          "code": "outcome",
          "display": "Outcome"
        } ]
      }
    } ],
    "population": [ {
      "id": "24BB5BA9-820F-4958-B8AA-AA8962E9E398",
      "code": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/measure-population",
          "code": "initial-population",
          "display": "Initial Population"
        } ]
      },
      "description": "All Medicare Fee-For-Service encounters age 65 to 94 years at the start of an inpatient admission, who are discharged during the measurement period (length of stay <365 days).\n\nNOTE: All Medicare Fee-For-Service encounters meeting the above criteria should be included, regardless if Medicare Fee-For-Service is the primary, secondary, or tertiary payer.",
      "criteria": {
        "language": "text/cql-identifier",
        "expression": "Initial Population"
      }
    } ]
  } ],
  "supplementalData": [ {
    "id": "results",
    "usage": [ {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/measure-data-usage",
        "code": "supplemental-data"
      } ]
    } ],
    "description": "Results",
    "criteria": {
      "language": "text/cql-identifier",
      "expression": "Results"
    }
  }, {
    "id": "sde-ethnicity",
    "usage": [ {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/measure-data-usage",
        "code": "supplemental-data"
      } ]
    } ],
    "description": "SDE Ethnicity",
    "criteria": {
      "language": "text/cql-identifier",
      "expression": "SDE Ethnicity"
    }
  }, {
    "id": "sde-payer",
    "usage": [ {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/measure-data-usage",
        "code": "supplemental-data"
      } ]
    } ],
    "description": "SDE Payer",
    "criteria": {
      "language": "text/cql-identifier",
      "expression": "SDE Payer"
    }
  }, {
    "id": "sde-race",
    "usage": [ {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/measure-data-usage",
        "code": "supplemental-data"
      } ]
    } ],
    "description": "SDE Race",
    "criteria": {
      "language": "text/cql-identifier",
      "expression": "SDE Race"
    }
  }, {
    "id": "sde-sex",
    "usage": [ {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/measure-data-usage",
        "code": "supplemental-data"
      } ]
    } ],
    "description": "SDE Sex",
    "criteria": {
      "language": "text/cql-identifier",
      "expression": "SDE Sex"
    }
  } ]
}